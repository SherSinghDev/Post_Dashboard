<!DOCTYPE html>
<html lang="en">
<%- include('./globals/head') %>

	<body>

		<!--*******************
        Preloader start
    ********************-->
		<%- include('./globals/preloader') %>
		<!--*******************
        Preloader end
    ********************-->

		<!--**********************************
        Main wrapper start
    ***********************************-->
		<div id="main-wrapper">
			<!--**********************************
            Nav header start
        ***********************************-->
			<%- include('globals/navHeader') %>
			<!--**********************************
            Nav header end
        ***********************************-->

			<!--**********************************
            Chat box start
        ***********************************-->
			
			<!--**********************************
            Chat box End
        ***********************************-->

			<!--**********************************
            Header start
        ***********************************-->
			<%- include('globals/header') %>
			<!--**********************************
            Header end ti-comment-alt
        ***********************************-->

			<!--**********************************
            Sidebar start
        ***********************************-->
			<%- include('globals/sidebar') %>

			<!--**********************************
            Sidebar end
        ***********************************-->

			<!--**********************************
            Content body start
        ***********************************-->
			<div class="content-body">
				<div class="container">
					
					
					<div class="row">
						<h1 class="mb-3">All Admins</h1>
						<% users.forEach((p)=>{%>
							<%if(p.role=='Admin'){%>
								<div class="col-xl-4 col-md-4">
									<div class="card">
										<div class="card-header border-0 pb-0">
											<h2 class="text-center w-100 d-flex justify-content-between">
												<span style="flex-grow: 1;">
													<%=p.username %>
												</span>
												<div class="dropdown custom-dropdown mb-0">
													<div class="btn sharp btn-primary tp-btn" data-bs-toggle="dropdown"
														aria-expanded="false">
														<svg xmlns="http://www.w3.org/2000/svg"
															xmlns:xlink="http://www.w3.org/1999/xlink" width="18px"
															height="18px" viewBox="0 0 24 24" version="1.1">
															<g stroke="none" stroke-width="1" fill="none"
																fill-rule="evenodd">
																<rect x="0" y="0" width="24" height="24"></rect>
																<circle fill="#000000" cx="12" cy="5" r="2"></circle>
																<circle fill="#000000" cx="12" cy="12" r="2"></circle>
																<circle fill="#000000" cx="12" cy="19" r="2"></circle>
															</g>
														</svg>
													</div>
													<div class="dropdown-menu dropdown-menu-end">
														<a class="dropdown-item edit-btn" data-bs-toggle="modal"
															data-bs-target=".bd-example-modal-lg"
															data-url="/patients/update/<%= p._id %>"
															href="javascript:void();">Edit</a>
														<a class="dropdown-item text-danger delete-btn"
															data-id="<%= p._id %>" href="javascript:void();;">Delete</a>

													</div>
												</div>
											</h2>
										</div>

										<div class="card-body pb-0 pt-1">
											</p>
											<ul class="list-group list-group-flush px-4">
												<li class="list-group-item d-flex px-0 justify-content-between"
													style="font-size: 15px !important;">
													<strong>Email</strong>
													<span class="mb-0">
														<%=p.email %>
													</span>
												</li>
												<li class="list-group-item d-flex px-0 justify-content-between"
													style="font-size: 15px !important;">
													<strong>Role</strong>
													<span class="mb-0">
														<%=p.role %>
													</span>
												</li>
												<li class="list-group-item d-flex px-0 justify-content-between"
													style="font-size: 15px !important;">
													<strong>City</strong>
													<span class="mb-0">
														<%=p.city %>
													</span>
												</li>
											</ul>
										</div>
										<div class="card-footer text-center py-4">
											<a href="javascript:void(0);" class="btn btn-primary">See Profile and
												Coordinators</a>
										</div>
									</div>
								</div>
								<%}%>
									<% }) %>

					</div>

					<div class="row mt-4">
						<h1 class="mb-3">All Team Leaders</h1>
						<% users.forEach((p)=>{%>
							<%if(p.role=='Team Leader'){%>
								<div class="col-xl-4 col-md-4">
									<div class="card">
										<div class="card-header border-0 pb-0">
											<h2 class="text-center w-100 d-flex justify-content-between">
												<span style="flex-grow: 1;">
													<%=p.username %>
												</span>
												<div class="dropdown custom-dropdown mb-0">
													<div class="btn sharp btn-primary tp-btn" data-bs-toggle="dropdown"
														aria-expanded="false">
														<svg xmlns="http://www.w3.org/2000/svg"
															xmlns:xlink="http://www.w3.org/1999/xlink" width="18px"
															height="18px" viewBox="0 0 24 24" version="1.1">
															<g stroke="none" stroke-width="1" fill="none"
																fill-rule="evenodd">
																<rect x="0" y="0" width="24" height="24"></rect>
																<circle fill="#000000" cx="12" cy="5" r="2"></circle>
																<circle fill="#000000" cx="12" cy="12" r="2"></circle>
																<circle fill="#000000" cx="12" cy="19" r="2"></circle>
															</g>
														</svg>
													</div>
													<div class="dropdown-menu dropdown-menu-end">
														<a class="dropdown-item edit-btn" data-bs-toggle="modal"
															data-bs-target=".bd-example-modal-lg"
															data-url="/patients/update/<%= p._id %>"
															href="javascript:void();">Edit</a>
														<a class="dropdown-item text-danger delete-btn"
															data-id="<%= p._id %>" href="javascript:void();;">Delete</a>

													</div>
												</div>
											</h2>
										</div>

										<div class="card-body pb-0 pt-1">
											</p>
											<ul class="list-group list-group-flush px-4">
												<li class="list-group-item d-flex px-0 justify-content-between"
													style="font-size: 15px !important;">
													<strong>Email</strong>
													<span class="mb-0">
														<%=p.email %>
													</span>
												</li>
												<li class="list-group-item d-flex px-0 justify-content-between"
													style="font-size: 15px !important;">
													<strong>Role</strong>
													<span class="mb-0">
														<%=p.role %>
													</span>
												</li>
												<li class="list-group-item d-flex px-0 justify-content-between"
													style="font-size: 15px !important;">
													<strong>City</strong>
													<span class="mb-0">
														<%=p.city %>
													</span>
												</li>
											</ul>
										</div>
										<div class="card-footer text-center py-4">
											<a href="javascript:void(0);" class="btn btn-primary">See Profile and
												Coordinators</a>
										</div>
									</div>
								</div>
								<%}%>
									<% }) %>

					</div>
				</div>
			</div>
		</div>

		<!--**********************************
            Content body end
        ***********************************-->


		<!-- Modal -->
		<div class="modal fade bd-example-modal-lg" tabindex="-1" style="display: none;" aria-hidden="true">
			<div class="modal-dialog modal-lg">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">Edit User Details</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal">
						</button>
					</div>
					<div class="modal-body">
						<div class="basic-form">
							<form id="update-user">
								<div class="row">
									<div class="mb-3 col-md-6">
										<label class="form-label">Name</label>
										<input type="text" class="form-control" placeholder="1234 Main St">
									</div>
									<div class="mb-3 col-md-6">
										<label class="form-label">Email</label>
										<input type="email" class="form-control" placeholder="Email">
									</div>
									<div class="mb-3 col-md-6">
										<label class="form-label">Password</label>
										<input type="password" class="form-control" placeholder="Password">
									</div>
									<div class="mb-3 col-md-6">
										<label>City</label>
										<input type="text" placeholder="Enter Your City" class="form-control">
									</div>
								</div>
								<div class="row">
									<div class="">
										<label class="form-label">Role</label>
										<select id="inputState" class="default-select form-control wide">
											<option value="">Choose...</option>
											<option value="admin">Admin</option>
											<option value="coordinator">Coordinator</option>
											<option value="customer">Customer</option>
										</select>
									</div>

								</div>
							</form>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-danger light close-btn"
							data-bs-dismiss="modal">Close</button>
						<button type="submit" form="update-user" class="btn btn-primary">Save changes</button>
					</div>
				</div>
			</div>
		</div>

		<!--**********************************
            Footer start
        ***********************************-->
		<div class="footer out-footer">
			<div class="copyright">
				<p>Copyright Â© Developed by <a href="https://dexignzone.com/" target="_blank">DexignZone</a> 2023</p>
			</div>
		</div>
		<!--**********************************
            Footer end
        ***********************************-->

		<!--**********************************
           Support ticket button start
        ***********************************-->

		<!--**********************************
           Support ticket button end
        ***********************************-->


		</div>
		<!--**********************************
        Main wrapper end
    ***********************************-->

		<!--**********************************
        Scripts
    ***********************************-->
		<!-- Required vendors -->
		<script src="/vendor/global/global.min.js"></script>
		<script src="/vendor/bootstrap-select/dist/js/bootstrap-select.min.js"></script>

		<!-- Dashboard 1 -->
		<script src="/vendor/datatables/js/jquery.dataTables.min.js"></script>
		<script src="/js/plugins-init/datatables.init.js"></script>


		<!-- JS for dotted map -->




		<!-- Apex Chart -->



		<!-- Vectormap -->

		<script src="/js/custom.js"></script>
		<script src="/js/deznav-init.js"></script>
		<script src="/js/demo.js"></script>
		<script src="/js/styleSwitcher.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert2/11.23.0/sweetalert2.min.js"></script>
		<script src="/js/pages/patients.js"></script>
		<script>
			$(document).on('click', '.edit-btn', function (e) {
				let url = $(this).attr('data-url')
				let form = $('#tracking-update')
				form.attr('data-url', url)
			})

			$(document).on('submit', '#tracking-update', function (e) {
				e.preventDefault()
				let form = $(this)
				let input = this.trackingid
				let url = form.attr('data-url')
				let data = {
					trackingId: input.value
				}

				$.ajax({
					url,
					data,
					method: "POST",
					success: function (data) {
						if (data.updated) {
							$('.btn-close').click()
							input.value = ''
							$(data.td).html(data.tdHtml)
						}
					},
					error: function (err) {
						console.log(err);
					}
				})

			})

			// track btn
			$(document).on('click', ".track-btn", function () {
				let id = $(this).attr('data-id')
				console.log(id);
				navigator.clipboard.writeText(id)
					.then(() => {
						console.log("Copied to clipboard");
						window.open('https://www.indiapost.gov.in/home', "_blank")
					})
					.catch((err) => {
						console.log(err);
					})
			})



			// delete
			$(document).on('click', '.delete-btn', function () {
				Swal.fire({
					title: "Do you want to delete the record?",
					showDenyButton: true,
					// showCancelButton: true,
					confirmButtonText: "Delete",
					denyButtonText: `Cancel`
				}).then((result) => {
					/* Read more about isConfirmed, isDenied below */
					if (result.isConfirmed) {
						let id = $(this).attr('data-id')
						console.log(id);
						$.ajax({
							url: `/users/delete/${id}`,
							method: "DELETE",
							success: function (data) {
								console.log(data);
								if (data.deleted) {
									Swal.fire({
										title: "Success!",
										icon: "success",
										text: "Deleted Successfully",
										timer: 1500
									});
									console.log(data.tr);
									$(data.tr).fadeOut(1000)
								}
								else {
									Swal.fire({
										icon: "error",
										title: "Oops...",
										text: "Something Went Wrong",
										timer: 1500
									});
								}
							},
							error: function (err) {
								console.log(err);
							}
						})
					}
				});

			})

			$(document).on('click', '.logout-btn', function (e) {
                Swal.fire({
                    title: "Do you want to Logout?",
                    showDenyButton: true,
                    // showCancelButton: true,
                    confirmButtonText: "Yes",
                    denyButtonText: `Cancel`
                }).then((result) => {
                    /* Read more about isConfirmed, isDenied below */
                    if (result.isConfirmed) {

                        $.ajax({
                            url: `/auth/logout`,
                            method: "POST",
                            success: function (data) {
                                console.log(data);
                                if (data.logout) {
                                    window.location.href = '/'
                                }
                                else {
                                    Swal.fire({
                                        icon: "error",
                                        title: "Oops...",
                                        text: "Something Went Wrong",
                                        timer: 1500
                                    });
                                }
                            },
                            error: function (err) {
                                console.log(err);
                            }
                        })
                    }
                });
            })

			var handleNavigation = function () {
                $(".nav-control").on('click', function () {

                    $('#main-wrapper').toggleClass("menu-toggle");

                    $(".hamburger").toggleClass("is-active");
                });
            }

            handleNavigation()
		</script>
	</body>

</html>